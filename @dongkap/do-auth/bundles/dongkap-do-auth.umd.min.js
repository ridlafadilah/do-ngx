!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@nebular/theme"),require("@angular/common"),require("@angular/forms"),require("@angular/common/http"),require("@ngx-translate/core"),require("ng-recaptcha"),require("@dongkap/do-core"),require("@dongkap/do-theme"),require("@dongkap/do-common"),require("@angular/router"),require("rxjs"),require("rxjs/operators"),require("@ng-idle/core"),require("@dongkap/do-storage")):"function"==typeof define&&define.amd?define("@dongkap/do-auth",["exports","@angular/core","@nebular/theme","@angular/common","@angular/forms","@angular/common/http","@ngx-translate/core","ng-recaptcha","@dongkap/do-core","@dongkap/do-theme","@dongkap/do-common","@angular/router","rxjs","rxjs/operators","@ng-idle/core","@dongkap/do-storage"],t):t(((e=e||self).dongkap=e.dongkap||{},e.dongkap["do-auth"]={}),e.ng.core,e["@nebular/theme"],e.ng.common,e.ng.forms,e.ng.common.http,e["@ngx-translate/core"],e["ng-recaptcha"],e["@dongkap/do-core"],e["@dongkap/do-theme"],e["@dongkap/do-common"],e.ng.router,e.rxjs,e.rxjs.operators,e["@ng-idle/core"],e["@dongkap/do-storage"])}(this,(function(e,t,r,n,o,s,a,i,c,l,u,p,d,h,m,g){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var f=function(e,t){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}f(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function b(e,t,r,n){return new(r||(r=Promise))((function(o,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function i(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,i)}c((n=n.apply(e,t||[])).next())}))}function v(e,t){var r,n,o,s,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}}Object.create;function w(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,s=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=s.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(o)throw o.error}}return a}function S(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(w(arguments[t]));return e}Object.create;var P=function(e){function r(t){return e.call(this,t,"do-core",1,"#do-auth")||this}return y(r,e),r.prototype.getEnc=function(e,t){return b(this,void 0,void 0,(function(){var r,n=this;return v(this,(function(o){switch(o.label){case 0:return r=this.enc.getHmacSha256(this.oauthResource.private_key,e,!0),[4,this.$dbPromise];case 1:return[2,o.sent().get(t||"#do-auth",r).then((function(e){return n.enc.decryptAES(n.oauthResource.aes_key,e)}))]}}))}))},r.prototype.putEnc=function(e,t,r){return b(this,void 0,void 0,(function(){var n,o;return v(this,(function(s){switch(s.label){case 0:return n=this.enc.getHmacSha256(this.oauthResource.private_key,e,!0),o=this.enc.encryptAES(this.oauthResource.aes_key,t),[4,this.$dbPromise];case 1:return[2,s.sent().put(r||"#do-auth",o,n)]}}))}))},r.prototype.removeEnc=function(e,t){return b(this,void 0,void 0,(function(){var r;return v(this,(function(n){switch(n.label){case 0:return r=this.enc.getHmacSha256(this.oauthResource.private_key,e,!0),[4,this.$dbPromise];case 1:return[2,n.sent().delete(t||"#do-auth",r)]}}))}))},r.prototype.getOfEnc=function(e,t){var r=new d.Subject;return this.getEnc(e,t).then((function(e){r.next(e)})),r.asObservable()},r.prototype.putOfEnc=function(e,t,r){var n=new d.Subject;return this.putEnc(e,t,r).then((function(e){n.next(e)})),n.asObservable()},r.prototype.removeOfEnc=function(e,t){var r=new d.Subject;return this.removeEnc(e,t).then((function(e){r.next(e)})),r.asObservable()},r.prototype.loginStorage=function(e){var t=this;c.oauthInfoModels.forEach((function(r){e[r.key]&&r.type===c.TypeDataOauth.OAUTH&&(r.enc?t.putEnc(r.key,r.string?e[r.key]:JSON.stringify(e[r.key])).then():t.put(r.key,r.string?e[r.key]:JSON.stringify(e[r.key])).then())}))},r.prototype.logout=function(){var e=this;c.oauthInfoModels.forEach((function(t){t.enc&&t.type===c.TypeDataOauth.OAUTH&&e.removeEnc(t.key).then()}))},r.prototype.isLogin=function(){return b(this,void 0,void 0,(function(){var e=this;return v(this,(function(t){switch(t.label){case 0:return[4,this.getEnc(c.oauthInfo.access_token)];case 1:return t.sent()?[2,!0]:(c.oauthInfoModels.forEach((function(t){e.removeEnc(t.key).then()})),[2,!1])}}))}))},r.ctorParameters=function(){return[{type:t.Injector}]},r.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new r(t.ɵɵinject(t.INJECTOR))},token:r,providedIn:"root"}),r.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],r.ctorParameters=function(){return[{type:t.Injector}]},r}(g.IndexedDBService),I=function(e){function r(t){return e.call(this,t,"do-core",1,"#do-profile")||this}return y(r,e),r.prototype.loginStorage=function(e){var t=this;c.oauthInfoModels.forEach((function(r){e[r.key]&&r.type===c.TypeDataOauth.PROFILE&&t.put(r.key,r.string?e[r.key]:JSON.stringify(e[r.key])).then()}))},r.prototype.logout=function(){var e=this;c.oauthInfoModels.forEach((function(t){t.type===c.TypeDataOauth.PROFILE&&e.remove(t.key)}))},r.ctorParameters=function(){return[{type:t.Injector}]},r.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new r(t.ɵɵinject(t.INJECTOR))},token:r,providedIn:"root"}),r.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],r.ctorParameters=function(){return[{type:t.Injector}]},r}(g.IndexedDBService),E=function(e){function r(t){var r=e.call(this,t,"do-core",1,"#do-settings")||this;return r.translate=t.get(a.TranslateService),r}return y(r,e),r.prototype.loginStorage=function(e){var t=this;c.oauthInfoModels.forEach((function(r){e[r.key]&&r.type===c.TypeDataOauth.SETTINGS&&(t.put(r.key,r.string?e[r.key]:JSON.stringify(e[r.key])).then(),"locale"===r.key&&t.translate.getTranslation(e[r.key]).subscribe((function(n){t.translate.use(e[r.key]),t.translate.setTranslation(e[r.key],n,!0)})))}))},r.ctorParameters=function(){return[{type:t.Injector}]},r.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new r(t.ɵɵinject(t.INJECTOR))},token:r,providedIn:"root"}),r.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],r.ctorParameters=function(){return[{type:t.Injector}]},r}(g.IndexedDBService),k=function(){function e(e,t,r,n,o,s,a,i){var c=this;this.httpBaseService=e,this.oauthResource=t,this.apiPath=r,this.router=n,this.authIndexedDB=o,this.profileIndexedDB=s,this.settingsIndexedDB=a,this.idle=i,this.destroy$=new d.Subject,i.setIdle(t.session_idle),i.setTimeout(t.session_timeout),i.setInterrupts(m.DEFAULT_INTERRUPTSOURCES),i.onTimeout.subscribe((function(){c.logout()})),i.onIdleEnd.subscribe((function(){}))}return e.prototype.ngOnDestroy=function(){clearInterval(this.timer),this.destroy$.next(!0),this.destroy$.next(),this.destroy$.complete()},e.prototype.login=function(e,t){var r=this;return this.authIndexedDB.logout(),this.httpBaseService.HTTP_BASE(this.apiPath.auth.token,this.getAuthBody(e,t).toString(),this.getAuthHeader()).pipe(h.takeUntil(this.destroy$)).toPromise().then((function(e){r.idle.setIdle(+e.expires_in),r.idle.watch(),r.authIndexedDB.loginStorage(e),r.profileIndexedDB.loginStorage(e),r.settingsIndexedDB.loginStorage(e)}))},e.prototype.refresh=function(){var e=this;return this.getBodyRefresh().pipe(h.switchMap((function(t){return e.httpBaseService.HTTP_BASE(e.apiPath.auth.token,t,e.getAuthHeader()).pipe(h.takeUntil(e.destroy$)).pipe(h.map((function(t){e.idle.setIdle(t.expires_in),e.authIndexedDB.logout(),e.authIndexedDB.loginStorage(t)})))})))},e.prototype.logout=function(){var e=this;this.timer=setInterval((function(){e.doLogout()}),5e3),this.httpBaseService.HTTP_AUTH(this.apiPath.security.revoke).pipe(h.takeUntil(this.destroy$)).subscribe((function(){e.doLogout()}))},e.prototype.doLogout=function(){this.authIndexedDB.logout(),this.profileIndexedDB.logout(),clearInterval(this.timer),this.idle.stop(),this.router.navigate(["/auth"])},e.prototype.isLogin=function(){return b(this,void 0,void 0,(function(){return v(this,(function(e){switch(e.label){case 0:return[4,this.authIndexedDB.isLogin()];case 1:return[2,e.sent()]}}))}))},e.prototype.oauthHeaders=function(e){var t=new d.Subject,r=e.headers?e.headers:new s.HttpHeaders;return r=r.has(c.signatureHeader.authorization)?r.delete(c.signatureHeader.authorization):r,Promise.all([this.authIndexedDB.getEnc(c.oauthInfo.token_type),this.authIndexedDB.getEnc(c.oauthInfo.access_token)]).then((function(n){r=r.set(c.signatureHeader.authorization,n[0]+" "+n[1]),t.next(e.clone({headers:r}))})),t.asObservable()},e.prototype.getAuthHeader=function(){return new s.HttpHeaders({"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic "+btoa(this.oauthResource.client_id+":"+this.oauthResource.client_secret),Accept:"application/json"})},e.prototype.getAuthBody=function(e,t){var r=new URLSearchParams;return r.append("client_id",this.oauthResource.client_id),r.append("grant_type",this.oauthResource.grant_type),r.append("username",e),r.append("password",t),r},e.prototype.getBodyRefresh=function(){var e=this,t=new d.Subject;return this.authIndexedDB.getEnc(c.oauthInfo.refresh_token).then((function(r){var n=new URLSearchParams;n.append("client_id",e.oauthResource.client_id),n.append("grant_type","refresh_token"),n.append("refresh_token",r),t.next(n.toString())})),t.asObservable()},e.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[c.HTTP_SERVICE]}]},{type:void 0,decorators:[{type:t.Inject,args:[c.OAUTH_INFO]}]},{type:void 0,decorators:[{type:t.Inject,args:[c.API]}]},{type:p.Router},{type:P},{type:I},{type:E},{type:m.Idle}]},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[c.HTTP_SERVICE]}]},{type:void 0,decorators:[{type:t.Inject,args:[c.OAUTH_INFO]}]},{type:void 0,decorators:[{type:t.Inject,args:[c.API]}]},{type:p.Router},{type:P},{type:I},{type:E},{type:m.Idle}]},e}(),x=function(){function e(e,t,r){this.router=e,this.authTokenService=t,this.authService=r}return e.prototype.canActivate=function(e,t){var r=this,n=new d.Subject;return this.authTokenService.isLogin().then((function(e){n.next(e),e?"/auth/logout"!==t.url&&r.authService.loadPhotoUser():r.router.navigate(["/auth"])})),n.asObservable()},e.ctorParameters=function(){return[{type:p.Router},{type:k},{type:c.UserInfo,decorators:[{type:t.Inject,args:[c.USER_INFO]}]}]},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:p.Router},{type:k},{type:c.UserInfo,decorators:[{type:t.Inject,args:[c.USER_INFO]}]}]},e}(),T=function(){function e(e,t){this.router=e,this.authTokenService=t}return e.prototype.canActivate=function(e,t){var r=this,n=new d.Subject;return this.authTokenService.isLogin().then((function(e){n.next(!e),e&&r.router.navigate(["/app"])})),n.asObservable()},e.ctorParameters=function(){return[{type:p.Router},{type:k}]},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:p.Router},{type:k}]},e}(),C=function(){function e(e,t,r,n){this.router=e,this.authTokenService=t,this.enc=r,this.storage=n}return e.prototype.canActivateChild=function(e,t){var r=this,n=new d.Subject;return this.authTokenService.isLogin().then((function(t){n.next(t),e.data&&Promise.all([r.storage.getEnc("menus"),r.storage.getEnc("extras")]).then((function(t){return t[0].includes(e.data.code)||t[1].includes(e.data.code)||r.router.navigate(["/app/home"]),n.asObservable()})),t||r.router.navigate(["/auth"])})),n.asObservable()},e.ctorParameters=function(){return[{type:p.Router},{type:k},{type:c.EncryptionService},{type:P}]},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:p.Router},{type:k},{type:c.EncryptionService},{type:P}]},e}(),R=function(){function e(e){this.ref=e,this.action="Agree"}return e.prototype.submit=function(){this.ref.close(!0)},e.ctorParameters=function(){return[{type:r.NbDialogRef}]},e.decorators=[{type:t.Component,args:[{selector:"do-terms-conditions",template:'<nb-card [size]="\'medium\'">\n  <nb-card-header>\n    <h2>\n      <strong>\n        {{ \'header.terms-conditions\' | translate }}\n      </strong>\n    </h2>\n  </nb-card-header>\n  <nb-card-body>\n    <div [innerHTML]="content"></div>\n  </nb-card-body>\n  <nb-card-footer>\n    <button\n      type="submit"\n      status="primary"\n      size="large"\n      class="terms-button"\n      (click)="submit()"\n      nbButton>\n      {{ action | translate }}\n    </button>\n  </nb-card-footer>\n</nb-card>\n',styles:["/*!\n * @license\n * Copyright Akveo. All Rights Reserved.\n * Licensed under the MIT License. See License.txt in the project root for license information.\n */.nb-theme-default :host .cancel{margin-right:1rem}.nb-theme-default :host button.terms-button{width:100%}.nb-theme-dark :host .cancel{margin-right:1rem}.nb-theme-dark :host button.terms-button{width:100%}.nb-theme-cosmic :host .cancel{margin-right:1rem}.nb-theme-cosmic :host button.terms-button{width:100%}.nb-theme-corporate :host .cancel{margin-right:1rem}.nb-theme-corporate :host button.terms-button{width:100%}@media (max-width:767.98px){.nb-theme-default :host p{line-height:1.35rem;word-spacing:.15rem}.nb-theme-default :host button.terms-button{font-size:.6rem}.nb-theme-dark :host p{line-height:1.35rem;word-spacing:.15rem}.nb-theme-dark :host button.terms-button{font-size:.6rem}.nb-theme-cosmic :host p{line-height:1.35rem;word-spacing:.15rem}.nb-theme-cosmic :host button.terms-button{font-size:.6rem}.nb-theme-corporate :host p{line-height:1.35rem;word-spacing:.15rem}.nb-theme-corporate :host button.terms-button{font-size:.6rem}}"]}]}],e.ctorParameters=function(){return[{type:r.NbDialogRef}]},e.propDecorators={content:[{type:t.Input}],action:[{type:t.Input}]},e}(),A=function(){function e(e,t,r,n,s,a,i,c){this.router=e,this.dialogService=t,this.translate=r,this.authTokenService=n,this.apiPath=s,this.httpBaseService=a,this.oauthResource=i,this.buttonLogin=!1,this.progressBar=25,this.destroy$=new d.Subject,this.form=new o.FormGroup({username:new o.FormControl,password:new o.FormControl}),this.urlAuthorizeGoogle=this.httpBaseService.API(this.apiPath.auth.authorize)+"/google?redirect_uri="+document.getElementsByTagName("base")[0].href+"auth/callback",this.socialLinks=[{url:this.urlAuthorizeGoogle,target:"_self",icon:"google"}],c.snapshot.queryParams.error&&(console.log(c.snapshot.queryParams.error),this.responseError="error."+c.snapshot.queryParams.error)}return e.prototype.ngOnDestroy=function(){this.destroy$.next(!0),this.destroy$.complete(),this.destroy$.unsubscribe()},e.prototype.login=function(){var e=this;if(!this.form.invalid){document.querySelectorAll(".pace-done").forEach((function(e){e.className=e.className.replace("pace-done pace-done","pace-running"),e.className=e.className.replace("pace-done","pace-running")})),document.querySelectorAll(".pace-inactive").forEach((function(e){e.className=e.className.replace("pace-inactive pace-inactive","pace-active"),e.className=e.className.replace("pace-inactive","pace-active")}));var t=document.getElementsByClassName("pace-progress").item(0);this.progressBar<35&&(this.progressBar=35,t.style.transform="translate3d("+this.progressBar+"%, 0px, 0px)",t.getAttributeNode("data-progress-text").value=this.progressBar+"%",t.getAttributeNode("data-progress").value=this.progressBar.toString()),this.buttonLogin=!0,this.authTokenService.login(this.form.get("username").value,this.form.get("password").value).then((function(){e.responseError=null,e.progressBar=90,t.style.transform="translate3d("+e.progressBar+"%, 0px, 0px)",t.getAttributeNode("data-progress-text").value=e.progressBar+"%",t.getAttributeNode("data-progress").value=e.progressBar.toString(),e.progressBar=0,e.router.navigate(["/app/home"])})).catch((function(r){if(!(r instanceof s.HttpErrorResponse)){var n=r;e.responseError=n.respStatusMessage[n.respStatusCode]}e.buttonLogin=!1,e.progressBar=85,t.style.transform="translate3d("+e.progressBar+"%, 0px, 0px)",t.getAttributeNode("data-progress-text").value=e.progressBar+"%",t.getAttributeNode("data-progress").value=e.progressBar.toString(),document.querySelectorAll(".pace-running").forEach((function(e){e.className=e.className.replace("pace-running","pace-done")})),document.querySelectorAll(".pace-active").forEach((function(e){e.className=e.className.replace("pace-active","pace-inactive")})),e.progressBar=0})),this.progressBar>=35&&this.progressBar<65&&(this.progressBar=65,t.style.transform="translate3d("+this.progressBar+"%, 0px, 0px)",t.getAttributeNode("data-progress-text").value=this.progressBar+"%",t.getAttributeNode("data-progress").value=this.progressBar.toString())}},Object.defineProperty(e.prototype,"hasErrorUsername",{get:function(){return this.form.controls.username&&this.form.controls.username.invalid&&this.form.controls.username.touched},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasSuccessUsername",{get:function(){return this.form.controls.username&&this.form.controls.username.valid&&this.form.controls.username.touched},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasErrorPassword",{get:function(){return this.form.controls.password&&this.form.controls.password.invalid&&this.form.controls.password.touched},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasSuccessPassword",{get:function(){return this.form.controls.password&&this.form.controls.password.valid&&this.form.controls.password.touched},enumerable:!1,configurable:!0}),e.prototype.onClickTermsConditions=function(){var e=this,t=new s.HttpHeaders({Authorization:"Basic "+btoa(this.oauthResource.client_id+":"+this.oauthResource.client_secret),"Content-Type":"application/json","Accept-Language":this.translate.currentLang});this.httpBaseService.HTTP_BASE(this.apiPath.openapi.parameter,{parameterCode:"TERMS_CONDITIONS.DONGKAP"},t).pipe(h.takeUntil(this.destroy$)).subscribe((function(t){e.dialogService.open(R,{context:{content:t.parameterValue,action:"Close"}})}))},e.ctorParameters=function(){return[{type:p.Router},{type:r.NbDialogService},{type:a.TranslateService},{type:k},{type:void 0,decorators:[{type:t.Inject,args:[c.API]}]},{type:void 0,decorators:[{type:t.Inject,args:[c.HTTP_SERVICE]}]},{type:void 0,decorators:[{type:t.Inject,args:[c.OAUTH_INFO]}]},{type:p.ActivatedRoute}]},e.decorators=[{type:t.Component,args:[{selector:"do-login-page",template:'<h1 id="title" class="title">{{ \'Login\' | translate }}</h1>\n<p class="sub-title">{{ \'subtitle.login\' | translate }}</p>\n<nb-alert *ngIf="responseError" outline="danger" role="alert">\n  <p class="alert-title"><b>{{ \'alert.title.login\' | translate }}</b></p>\n  <ul class="alert-message-list">\n    <li class="alert-message">{{ responseError | translate }}</li>\n  </ul>\n</nb-alert>\n\n<form [formGroup]="form" (ngSubmit)="login()" aria-labelledby="title">\n  <div class="form-control-group">\n    <label class="label">{{ \'message.username-login\' | translate }} :</label>\n    <input [formControlName]="\'username\'"\n          [required]="true"\n          [ngClass]="{\n            \'status-danger\': hasErrorUsername,\n            \'status-success\': hasSuccessUsername\n          }"\n          name="username"\n          id="inputUsername"\n          placeholder="{{ \'message.username-login-placeholder\' | translate }}"\n          fieldSize="large"\n          tabindex="1"\n          autofocus\n          nbInput\n          fullWidth>\n    <ng-container *ngIf="hasErrorUsername">\n      <span class="caption status-danger">{{\'error.username-login\' | translate}}</span>\n    </ng-container>\n  </div>\n\n  <div class="form-control-group">\n    <span class="label-with-link">\n      <label class="label">{{ \'Password\' | translate }} :</label>\n      <a class="forgot-password caption-2" routerLink="/auth/forgot-password" tabindex="-1">{{ \'Forgot Password\' | translate}}?</a>\n    </span>\n    <input [formControlName]="\'password\'"\n          [required]="true"\n          [ngClass]="{\n            \'status-danger\': hasErrorPassword,\n            \'status-success\': hasSuccessPassword\n          }"\n          name="password"\n          type="password"\n          id="inputPassword"\n          placeholder="{{ \'Password\' | translate }}"\n          fieldSize="large"\n          tabindex="2"\n          nbInput\n          fullWidth>\n    <ng-container *ngIf="hasErrorPassword">\n      <span class="caption status-danger">{{ \'error.password\' | translate}}</span>\n    </ng-container>\n  </div>\n\n  <button [disabled]="form.invalid || buttonLogin"\n          fullWidth\n          nbButton\n          status="primary"\n          size="large"\n          [class.btn-pulse]="form.invalid || buttonLogin">\n    {{ \'Login\' | translate }}\n  </button>\n</form>\n\n<section *ngIf="socialLinks && socialLinks.length > 0" class="links" aria-label="Social sign in">\n  {{ \'message.login-footer-social\' | translate}}:\n  <div class="socials">\n    <ng-container *ngFor="let socialLink of socialLinks">\n      <a *ngIf="socialLink.link"\n         [routerLink]="socialLink.link"\n         [attr.target]="socialLink.target"\n         [attr.class]="socialLink.icon"\n         [class.with-icon]="socialLink.icon">\n        <nb-icon *ngIf="socialLink.icon; else title" [icon]="socialLink.icon"></nb-icon>\n        <ng-template #title>{{ socialLink.title }}</ng-template>\n      </a>\n      <a *ngIf="socialLink.url"\n         [attr.href]="socialLink.url"\n         [attr.target]="socialLink.target"\n         [attr.class]="socialLink.icon"\n         [class.with-icon]="socialLink.icon">\n        <nb-icon *ngIf="socialLink.icon; else title" [icon]="socialLink.icon"></nb-icon>\n        <ng-template #title>{{ socialLink.title }}</ng-template>\n      </a>\n    </ng-container>\n  </div>\n</section>\n\n<section class="another-action" aria-label="Register">\n  {{ \'message.login-footer\' | translate}} <a class="text-link" routerLink="/auth/register">{{ \'Register\' | translate}}</a>\n</section>\n\n<section class="another-action" aria-label="Terms and Conditions">\n  <span class="terms-conditions" (click)="onClickTermsConditions()" tabindex="-1">{{ \'message.terms-conditions\' | translate}}</span>\n</section>\n',styles:[".terms-conditions{color:#36f;text-decoration:underline;font-size:inherit;font-style:inherit;font-weight:inherit;line-height:inherit;cursor:pointer}.terms-conditions:hover{color:#598bff}"]}]}],e.ctorParameters=function(){return[{type:p.Router},{type:r.NbDialogService},{type:a.TranslateService},{type:k},{type:void 0,decorators:[{type:t.Inject,args:[c.API]}]},{type:void 0,decorators:[{type:t.Inject,args:[c.HTTP_SERVICE]}]},{type:void 0,decorators:[{type:t.Inject,args:[c.OAUTH_INFO]}]},{type:p.ActivatedRoute}]},e}(),B=function(){function e(e){this.authTokenService=e,this.authTokenService.logout()}return e.ctorParameters=function(){return[{type:k}]},e.decorators=[{type:t.Component,args:[{selector:"do-logout",template:'<p class="sub-title">{{ \'message.logout\' | translate }}</p>\n<div class="spinner-area" [nbSpinner]="true" nbSpinnerSize="small" nbSpinnerStatus="info">',styles:[".nb-theme-default :host .sub-title{margin:1rem}.nb-theme-default :host .spinner-area{height:22px}.nb-theme-default :host ::ng-deep nb-spinner{background:0 0!important}.nb-theme-dark :host .sub-title{margin:1rem}.nb-theme-dark :host .spinner-area{height:22px}.nb-theme-dark :host ::ng-deep nb-spinner{background:0 0!important}.nb-theme-cosmic :host .sub-title{margin:1rem}.nb-theme-cosmic :host .spinner-area{height:22px}.nb-theme-cosmic :host ::ng-deep nb-spinner{background:0 0!important}.nb-theme-corporate :host .sub-title{margin:1rem}.nb-theme-corporate :host .spinner-area{height:22px}.nb-theme-corporate :host ::ng-deep nb-spinner{background:0 0!important}"]}]}],e.ctorParameters=function(){return[{type:k}]},e}(),N=function(){function e(e){this.location=e}return e.prototype.back=function(){return this.location.back(),!1},e.prototype.ngOnDestroy=function(){this.alive=!1},e.ctorParameters=function(){return[{type:n.Location}]},e.decorators=[{type:t.Component,args:[{selector:"do-auth",template:'<nb-layout>\n    <nb-layout-column>\n        <nb-card>\n            <nb-card-header>\n                <nav class="navigation">\n                    <a href="#" (click)="back()" class="link back-link" aria-label="Back" tabindex="-1">\n                        <nb-icon icon="arrow-back"></nb-icon>\n                    </a>\n                </nav>\n            </nb-card-header>\n            <nb-card-body>\n                <do-auth-block>\n                    <router-outlet></router-outlet>\n                </do-auth-block>\n            </nb-card-body>\n        </nb-card>\n    </nb-layout-column>\n</nb-layout>',styles:["/*!\n * @license\n * Copyright Akveo. All Rights Reserved.\n * Licensed under the MIT License. See License.txt in the project root for license information.\n */:host nb-card{margin:0;height:calc(100vh - 2 * 2.5rem)}:host .navigation .link{display:inline-block;text-decoration:none}:host .navigation .link nb-icon{font-size:2rem;vertical-align:middle}:host .links nb-icon{font-size:2.5rem}:host nb-card-body{display:flex;width:100%}:host do-auth-block{margin:auto}:host ::ng-deep nb-layout .layout .layout-container .content .columns nb-layout-column{padding:2.5rem}@media (max-width:767.98px){:host nb-card{border-radius:0;height:100vh}:host ::ng-deep nb-layout .layout .layout-container .content .columns nb-layout-column{padding:0}}"]}]}],e.ctorParameters=function(){return[{type:n.Location}]},e}(),j=function(){function e(e,t,r,n,s,a,i,l){this.router=e,this.enc=t,this.toastr=r,this.dialogService=n,this.translate=s,this.httpBaseService=a,this.oauthResource=i,this.apiPath=l,this.patternFullname=c.Pattern.FULLNAME,this.patternUsername=c.Pattern.USERNAME,this.patternEmail=c.Pattern.EMAIL,this.patternPassword=c.Pattern.PASSWORD_MEDIUM,this.minlengthUsername=4,this.minlengthEmail=5,this.form=new o.FormGroup({fullname:new o.FormControl,username:new o.FormControl,email:new o.FormControl,password:new o.FormControl,confirmPassword:new o.FormControl,terms:new o.FormControl,recaptcha:new o.FormControl}),this.buttonRegister=!1,this.progressBar=25,this.isCheckUsername=!0,this.isCheckEmail=!0,this.destroy$=new d.Subject}return e.prototype.ngOnDestroy=function(){this.destroy$.next(!0),this.destroy$.complete(),this.destroy$.unsubscribe()},e.prototype.register=function(){var e=this;if(!this.form.invalid){document.querySelectorAll(".pace-done").forEach((function(e){e.className=e.className.replace("pace-done pace-done","pace-running"),e.className=e.className.replace("pace-done","pace-running")})),document.querySelectorAll(".pace-inactive").forEach((function(e){e.className=e.className.replace("pace-inactive pace-inactive","pace-active"),e.className=e.className.replace("pace-inactive","pace-active")}));var t=document.getElementsByClassName("pace-progress").item(0);this.progressBar<35&&(this.progressBar=35,t.style.transform="translate3d("+this.progressBar+"%, 0px, 0px)",t.getAttributeNode("data-progress-text").value=this.progressBar+"%",t.getAttributeNode("data-progress").value=this.progressBar.toString()),this.responseError=null;var r=this.form.value;r.password=this.enc.encryptAES(this.oauthResource.aes_key,this.form.controls.password.value),r.confirmPassword=this.enc.encryptAES(this.oauthResource.aes_key,this.form.controls.confirmPassword.value);var n=new s.HttpHeaders({Authorization:"Basic "+btoa(this.oauthResource.client_id+":"+this.oauthResource.client_secret),"Content-Type":"application/json","Accept-Language":this.translate.currentLang});this.buttonRegister=!0,this.httpBaseService.HTTP_BASE(this.apiPath.auth.signup,r,n).pipe(h.takeUntil(this.destroy$)).subscribe((function(r){r?(e.toastr.showI18n(r.respStatusMessage[r.respStatusCode]),e.progressBar=90,t.style.transform="translate3d("+e.progressBar+"%, 0px, 0px)",t.getAttributeNode("data-progress-text").value=e.progressBar+"%",t.getAttributeNode("data-progress").value=e.progressBar.toString(),e.progressBar=0,r.respStatusCode===c.ResponseCode.OK_REGISTERED?e.router.navigate(["/auth/login"]):(e.form.reset(),e.buttonRegister=!1)):(e.form.reset(),e.buttonRegister=!1)}),(function(r){if(e.buttonRegister=!1,e.progressBar=85,t.style.transform="translate3d("+e.progressBar+"%, 0px, 0px)",t.getAttributeNode("data-progress-text").value=e.progressBar+"%",t.getAttributeNode("data-progress").value=e.progressBar.toString(),document.querySelectorAll(".pace-running").forEach((function(e){e.className=e.className.replace("pace-running","pace-done")})),document.querySelectorAll(".pace-active").forEach((function(e){e.className=e.className.replace("pace-active","pace-inactive")})),e.progressBar=0,!(r instanceof s.HttpErrorResponse)&&r.respStatusCode){switch(r.respStatusCode){case c.ResponseCode.ERR_SCR0005.toString():e.form.controls.password.setErrors({invalid:!0});break;case c.ResponseCode.ERR_SCR0011.toString():e.form.controls.confirmPassword.setErrors({equal:!0})}e.responseError=r.respStatusMessage[r.respStatusCode]}}))}},Object.defineProperty(e.prototype,"hasErrorFullname",{get:function(){return this.form.controls.fullname.errors&&this.form.controls.fullname.invalid&&this.form.controls.fullname.touched?this.form.controls.fullname.errors.required?this.errorMsgFullname="error.fullname.required":this.errorMsgFullname="error.fullname.invalid":this.errorMsgFullname=null,this.form.controls.fullname&&this.form.controls.fullname.invalid&&this.form.controls.fullname.touched},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasSuccessFullname",{get:function(){return this.form.controls.fullname&&this.form.controls.fullname.valid&&this.form.controls.fullname.touched},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasErrorUsername",{get:function(){return this.form.controls.username.errors&&this.form.controls.username.invalid&&this.form.controls.username.touched?this.form.controls.username.errors.required?this.errorMsgUsername="error.username.required":this.form.controls.username.errors["not-available"]?(this.errorMsgUsername="error.username.not-available",this.paramMsgUsername={value:this.form.controls.username.value}):this.form.controls.username.errors.timeout?this.errorMsgUsername="error.0":this.form.controls.username.errors.error?this.errorMsgUsername="error.500":this.errorMsgUsername="error.username.invalid":((this.form.controls.username.touched||this.form.controls.username.dirty)&&this.isCheckUsername&&(this.isCheckUsername=!1,this.form.controls.username.setAsyncValidators([O(this.oauthResource,this.httpBaseService,this.apiPath)]),this.form.controls.username.updateValueAndValidity()),this.errorMsgUsername=null),this.form.controls.username&&this.form.controls.username.invalid&&this.form.controls.username.touched},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasSuccessUsername",{get:function(){return this.form.controls.username&&this.form.controls.username.valid&&this.form.controls.username.touched},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasErrorEmail",{get:function(){return this.form.controls.email.errors&&this.form.controls.email.invalid&&this.form.controls.email.touched?this.form.controls.email.errors.required?this.errorMsgEmail="error.email.required":this.form.controls.email.errors["not-available"]?(this.errorMsgEmail="error.email.not-available",this.paramMsgEmail={value:this.form.controls.email.value}):this.form.controls.email.errors.timeout?this.errorMsgEmail="error.0":this.form.controls.email.errors.error?this.errorMsgEmail="error.500":this.errorMsgEmail="error.email.invalid":((this.form.controls.email.touched||this.form.controls.email.dirty)&&this.isCheckEmail&&(this.isCheckEmail=!1,this.form.controls.email.setAsyncValidators([O(this.oauthResource,this.httpBaseService,this.apiPath)]),this.form.controls.email.updateValueAndValidity()),this.errorMsgEmail=null),this.form.controls.email&&this.form.controls.email.invalid&&this.form.controls.email.touched},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasSuccessEmail",{get:function(){return this.form.controls.email&&this.form.controls.email.valid&&this.form.controls.email.touched},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasErrorPassword",{get:function(){return this.form.controls.password.errors&&this.form.controls.password.invalid&&this.form.controls.password.touched?this.errorMsgPassword="error.pattern.Password":this.errorMsgPassword=null,this.form.controls.password&&this.form.controls.password.invalid&&this.form.controls.password.touched},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasSuccessPassword",{get:function(){return this.form.controls.password&&this.form.controls.password.valid&&this.form.controls.password.touched},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasErrorConfirmPassword",{get:function(){var e;return this.form.controls.confirmPassword.errors&&this.form.controls.confirmPassword.invalid&&this.form.controls.confirmPassword.touched?this.errorMsgConfirmPassword="error.equal.confirmPassword-register":this.form.controls.password.value!==this.form.controls.confirmPassword.value?(this.errorMsgConfirmPassword="error.equal.confirmPassword-register",this.form.controls.confirmPassword.setValidators([(e=this.form,function(t){return e.controls&&e.controls.password.value!==e.controls.confirmPassword.value?{equal:!0}:null})]),this.form.controls.confirmPassword.updateValueAndValidity()):this.errorMsgConfirmPassword=null,this.form.controls.confirmPassword&&this.form.controls.confirmPassword.invalid&&this.form.controls.confirmPassword.touched},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasSuccessConfirmPassword",{get:function(){return this.form.controls.confirmPassword&&this.form.controls.confirmPassword.valid&&this.form.controls.confirmPassword.touched},enumerable:!1,configurable:!0}),e.prototype.onCheckedChange=function(){this.form.controls.terms.value||this.form.controls.terms.setValue(null)},e.prototype.onClickTermsConditions=function(){var e=this,t=new s.HttpHeaders({Authorization:"Basic "+btoa(this.oauthResource.client_id+":"+this.oauthResource.client_secret),"Content-Type":"application/json","Accept-Language":this.translate.currentLang});this.httpBaseService.HTTP_BASE(this.apiPath.openapi.parameter,{parameterCode:"TERMS_CONDITIONS.DONGKAP"},t).pipe(h.takeUntil(this.destroy$)).subscribe((function(t){e.dialogService.open(R,{context:{content:t.parameterValue}}).onClose.subscribe((function(t){t&&e.form.controls.terms.setValue(!0)}))}))},e.prototype.onKeyDownUsername=function(e){e.key&&(e.key.match(/[!@#$%^&*()?":{}|<>\[\];\\=~`]/g)||-1!==["TAB","ESCAPE","ENTER","HOME","END","ARROWLEFT","ARROWRIGHT","ARROWUP","ARROWDOWN","PAGEUP","PAGEDOWN"].indexOf(e.key.toUpperCase())||e.ctrlKey||e.metaKey||e.altKey||(this.isCheckUsername=!0))},e.prototype.onKeyDownEmail=function(e){e.key&&(e.key.match(/[!#$%^&*()?":{}|<>\[\];\\=~`]/g)||-1!==["TAB","ESCAPE","ENTER","HOME","END","ARROWLEFT","ARROWRIGHT","ARROWUP","ARROWDOWN","PAGEUP","PAGEDOWN"].indexOf(e.key.toUpperCase())||e.ctrlKey||e.metaKey||e.altKey||(this.isCheckEmail=!0))},e.ctorParameters=function(){return[{type:p.Router},{type:c.EncryptionService},{type:u.DoToastrService},{type:r.NbDialogService},{type:a.TranslateService},{type:void 0,decorators:[{type:t.Inject,args:[c.HTTP_SERVICE]}]},{type:void 0,decorators:[{type:t.Inject,args:[c.OAUTH_INFO]}]},{type:void 0,decorators:[{type:t.Inject,args:[c.API]}]}]},e.decorators=[{type:t.Component,args:[{selector:"do-register-page",template:'<h1 id="title" class="title">{{ \'Register\' | translate }}</h1>\n\n<nb-alert *ngIf="responseError" outline="danger" role="alert">\n  <p class="alert-title"><b>{{ \'alert.title.register\' | translate }}</b></p>\n  <ul class="alert-message-list">\n    <li class="alert-message">{{ responseError }}</li>\n  </ul>\n</nb-alert>\n\n<form [formGroup]="form" (ngSubmit)="register()" aria-labelledby="title">\n\n  <div class="form-control-group">\n    <label class="label" for="input-name">{{ \'Full name\' | translate }}* :</label>\n    <input [formControlName]="\'fullname\'"\n          [required]="true"\n          minlength="4"\n          maxlength="50"\n          [pattern]="patternFullname"\n          [ngClass]="{\n            \'status-danger\': hasErrorFullname,\n            \'status-success\': hasSuccessFullname\n          }"\n          name="fullname"\n          id="inputFullname"\n          placeholder="{{ \'Full name\' | translate }}"\n          fieldSize="large"\n          tabindex="1"\n          autofocus\n          nbInput\n          fullWidth>\n    <ng-container *ngIf="hasErrorFullname">\n      <span class="caption status-danger">{{errorMsgFullname | translate}}</span>\n    </ng-container>\n  </div>\n\n  <div class="form-control-group">\n    <label class="label" for="input-username">{{ \'Username\' | translate }}* :</label>\n    <input [formControlName]="\'username\'"\n          [required]="true"\n          minlength="5"\n          maxlength="20"\n          [pattern]="patternUsername"\n          [ngClass]="{\n            \'status-danger\': hasErrorUsername,\n            \'status-success\': hasSuccessUsername\n          }"\n          name="username"\n          id="inputUsername"\n          (keydown)="onKeyDownUsername($event)"\n          placeholder="{{ \'Username\' | translate }}"\n          fieldSize="large"\n          tabindex="2"\n          autofocus\n          nbInput\n          fullWidth>\n    <ng-container *ngIf="hasErrorUsername">\n      <span class="caption status-danger">{{errorMsgUsername | translate:paramMsgUsername}}</span>\n    </ng-container>\n  </div>\n\n  <div class="form-control-group">\n    <label class="label" for="input-email">{{ \'Email\' | translate }}* :</label>\n    <input [formControlName]="\'email\'"\n          [required]="true"\n          minlength="5"\n          maxlength="50"\n          [pattern]="patternEmail"\n          [ngClass]="{\n            \'status-danger\': hasErrorEmail,\n            \'status-success\': hasSuccessEmail\n          }"\n          name="email"\n          id="inputEmail"\n          (keydown)="onKeyDownEmail($event)"\n          placeholder="{{ \'Email\' | translate }}"\n          fieldSize="large"\n          tabindex="3"\n          autofocus\n          nbInput\n          fullWidth>\n    <ng-container *ngIf="hasErrorEmail">\n      <span class="caption status-danger">{{errorMsgEmail | translate:paramMsgEmail}}</span>\n    </ng-container>\n  </div>\n\n  <div class="form-control-group">\n    <label class="label" for="input-password">{{ \'Password\' | translate }}* :</label>\n    <input [formControlName]="\'password\'"\n          [required]="true"\n          minlength="8"\n          maxlength="50"\n          [pattern]="patternPassword"\n          [ngClass]="{\n            \'status-danger\': hasErrorPassword,\n            \'status-success\': hasSuccessPassword\n          }"\n          name="password"\n          type="password"\n          id="inputPassword"\n          placeholder="{{ \'Password\' | translate }}"\n          fieldSize="large"\n          tabindex="4"\n          nbInput\n          fullWidth>\n    <ng-container *ngIf="hasErrorPassword">\n      <span class="caption status-danger">{{ errorMsgPassword | translate}}</span>\n    </ng-container>\n  </div>\n\n  <div class="form-control-group">\n    <label class="label" for="input-confirmpassword">{{ \'Confirm Password\' | translate }}* :</label>\n    <input [formControlName]="\'confirmPassword\'"\n          [required]="true"\n          minlength="8"\n          maxlength="50"\n          [ngClass]="{\n            \'status-danger\': hasErrorConfirmPassword,\n            \'status-success\': hasSuccessConfirmPassword\n          }"\n          name="confirmPassword"\n          type="password"\n          id="inputConfirmPassword"\n          placeholder="{{ \'Confirm Password\' | translate }}"\n          fieldSize="large"\n          tabindex="5"\n          nbInput\n          fullWidth>\n    <ng-container *ngIf="hasErrorConfirmPassword">\n      <span class="caption status-danger">{{ errorMsgConfirmPassword | translate}}</span>\n    </ng-container>\n  </div>\n\n  <div class="form-control-group accept-group">\n    <div class="terms-row row">\n      <nb-checkbox\n        name="terms"\n        [formControlName]="\'terms\'"\n        [required]="true"\n        (change)="onCheckedChange()">\n        {{ \'message.terms-conditions-label\' | translate}}\n      </nb-checkbox>\n      <span class="terms-conditions" (click)="onClickTermsConditions()" tabindex="-1"><strong>{{ \'message.terms-conditions\' | translate}}</strong></span>\n    </div>\n  </div>\n\n  <div class="form-control-group" style="transform:scale(0.7);transform-origin:0;">\n    <re-captcha\n      [formControlName]="\'recaptcha\'"\n      required>\n    </re-captcha>\n  </div>\n\n  <button [disabled]="!form.valid || buttonRegister"\n          fullWidth\n          nbButton\n          status="primary"\n          size="large"\n          [class.btn-pulse]="!form.valid || buttonRegister">\n    {{ \'Register\' | translate }}\n  </button>\n</form>\n\n<section class="another-action" aria-label="Sign in">\n  {{ \'message.register-footer\' | translate}} <a class="text-link" routerLink="/auth/login" tabindex="-1">{{ \'Login\' | translate}}</a>\n</section>\n',styles:[".terms-row{margin-left:0}.terms-conditions{padding:.1rem 0 0 .25rem;color:#36f;text-decoration:underline;font-size:inherit;font-style:inherit;font-weight:inherit;line-height:inherit;cursor:pointer}.terms-conditions:hover{color:#598bff}"]}]}],e.ctorParameters=function(){return[{type:p.Router},{type:c.EncryptionService},{type:u.DoToastrService},{type:r.NbDialogService},{type:a.TranslateService},{type:void 0,decorators:[{type:t.Inject,args:[c.HTTP_SERVICE]}]},{type:void 0,decorators:[{type:t.Inject,args:[c.OAUTH_INFO]}]},{type:void 0,decorators:[{type:t.Inject,args:[c.API]}]}]},e}();function O(e,t,r){return function(n){return n.valueChanges?n.valueChanges.pipe(h.debounceTime(500),h.distinctUntilChanged(),h.switchMap((function(){var o,a=new d.Subject,i=new s.HttpHeaders({Authorization:"Basic "+btoa(e.client_id+":"+e.client_secret),"Content-Type":"application/json"}),l={user:n.value};return n.value&&t.HTTP_BASE(r.auth["check-user"],l,i).subscribe((function(e){e.respStatusCode===c.ResponseCode.OK_SCR012.toString()?a.next(null):(o={error:!0},a.next(o))}),(function(e){o=e instanceof s.HttpErrorResponse?302===e.status?{"not-available":!0}:{timeout:!0}:{error:!0},a.next(o)})),a.asObservable()}))).pipe(h.first()):d.of(null)}}var _=function(){function e(e,t,r,n,s,a){this.router=e,this.toastr=t,this.translate=r,this.httpBaseService=n,this.oauthResource=s,this.apiPath=a,this.buttonForgotPassword=!1,this.progressBar=25,this.patternEmail=c.Pattern.EMAIL,this.form=new o.FormGroup({email:new o.FormControl}),this.destroy$=new d.Subject}return e.prototype.ngOnDestroy=function(){this.destroy$.next(!0),this.destroy$.complete(),this.destroy$.unsubscribe()},e.prototype.forgotPassword=function(){var e=this;if(!this.form.invalid){document.querySelectorAll(".pace-done").forEach((function(e){e.className=e.className.replace("pace-done pace-done","pace-running"),e.className=e.className.replace("pace-done","pace-running")})),document.querySelectorAll(".pace-inactive").forEach((function(e){e.className=e.className.replace("pace-inactive pace-inactive","pace-active"),e.className=e.className.replace("pace-inactive","pace-active")}));var t=document.getElementsByClassName("pace-progress").item(0);this.progressBar<35&&(this.progressBar=35,t.style.transform="translate3d("+this.progressBar+"%, 0px, 0px)",t.getAttributeNode("data-progress-text").value=this.progressBar+"%",t.getAttributeNode("data-progress").value=this.progressBar.toString()),this.responseError=null;var r=document.getElementsByTagName("base")[0].href+"auth/forgot-password",n={email:this.form.controls.email.value,urlForgotPassword:r},o=new s.HttpHeaders({Authorization:"Basic "+btoa(this.oauthResource.client_id+":"+this.oauthResource.client_secret),"Content-Type":"application/json","Accept-Language":this.translate.currentLang});this.buttonForgotPassword=!0,this.httpBaseService.HTTP_BASE(this.apiPath.auth["request-forgot-password"],n,o).pipe(h.takeUntil(this.destroy$)).subscribe((function(r){r?(e.toastr.showI18n(r.respStatusMessage[r.respStatusCode]),e.progressBar=90,t.style.transform="translate3d("+e.progressBar+"%, 0px, 0px)",t.getAttributeNode("data-progress-text").value=e.progressBar+"%",t.getAttributeNode("data-progress").value=e.progressBar.toString(),e.progressBar=0,r.respStatusCode===c.ResponseCode.OK_REQUEST_FORGOT_PASSWORD?e.router.navigate(["/auth/login"]):(e.form.reset(),e.buttonForgotPassword=!1)):(e.form.reset(),e.buttonForgotPassword=!1)}),(function(r){e.buttonForgotPassword=!1,e.progressBar=85,t.style.transform="translate3d("+e.progressBar+"%, 0px, 0px)",t.getAttributeNode("data-progress-text").value=e.progressBar+"%",t.getAttributeNode("data-progress").value=e.progressBar.toString(),document.querySelectorAll(".pace-running").forEach((function(e){e.className=e.className.replace("pace-running","pace-done")})),document.querySelectorAll(".pace-active").forEach((function(e){e.className=e.className.replace("pace-active","pace-inactive")})),e.progressBar=0,r instanceof s.HttpErrorResponse||r.respStatusCode&&(e.responseError=r.respStatusMessage[r.respStatusCode])}))}},Object.defineProperty(e.prototype,"hasErrorEmail",{get:function(){return this.form.controls.email&&this.form.controls.email.invalid&&this.form.controls.email.touched},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasSuccessEmail",{get:function(){return this.form.controls.email&&this.form.controls.email.valid&&this.form.controls.email.touched},enumerable:!1,configurable:!0}),e.ctorParameters=function(){return[{type:p.Router},{type:u.DoToastrService},{type:a.TranslateService},{type:void 0,decorators:[{type:t.Inject,args:[c.HTTP_SERVICE]}]},{type:void 0,decorators:[{type:t.Inject,args:[c.OAUTH_INFO]}]},{type:void 0,decorators:[{type:t.Inject,args:[c.API]}]}]},e.decorators=[{type:t.Component,args:[{selector:"do-request-forgot-page",template:'<h1 id="title" class="title">{{ \'Forgot Password\' | translate }}</h1>\n<p class="sub-title">{{ \'subtitle.forgot-password\' | translate }}</p>\n\n<nb-alert *ngIf="responseError" outline="danger" role="alert">\n  <p class="alert-title"><b>{{ \'alert.title.forgot\' | translate }}</b></p>\n  <ul class="alert-message-list">\n    <li class="alert-message">{{ responseError }}</li>\n  </ul>\n</nb-alert>\n\n<form [formGroup]="form" (ngSubmit)="forgotPassword()" aria-labelledby="title">\n  <div class="form-control-group">\n    <label class="label" for="input-name">{{ \'message.email-forgot-password\' | translate }} :</label>\n    <input [formControlName]="\'email\'"\n          [required]="true"\n          minlength="4"\n          maxlength="50"\n          [pattern]="patternEmail"\n          [ngClass]="{\n            \'status-danger\': hasErrorEmail,\n            \'status-success\': hasSuccessEmail\n          }"\n          name="email"\n          id="inputEmail"\n          placeholder="{{ \'Email\' | translate }}"\n          fieldSize="large"\n          tabindex="1"\n          autofocus\n          nbInput\n          fullWidth>\n    <ng-container *ngIf="hasErrorEmail">\n      <span class="caption status-danger">{{\'error.pattern.email\' | translate}}</span>\n    </ng-container>\n  </div>\n\n  <button [disabled]="form.invalid || buttonForgotPassword"\n          fullWidth\n          nbButton\n          status="primary"\n          size="large"\n          [class.btn-pulse]="form.invalid || buttonForgotPassword">\n    {{ \'Send\' | translate }}\n  </button>\n</form>\n\n<section class="sign-in-or-up" aria-label="Sign in or sign up">\n  <p><a class="text-link" routerLink="/auth/login">{{ \'message.forgot-password-link\' | translate}}</a></p>\n  <p><a routerLink="/auth/register" class="text-link">{{ \'Register\' | translate}}</a></p>\n</section>\n',styles:[""]}]}],e.ctorParameters=function(){return[{type:p.Router},{type:u.DoToastrService},{type:a.TranslateService},{type:void 0,decorators:[{type:t.Inject,args:[c.HTTP_SERVICE]}]},{type:void 0,decorators:[{type:t.Inject,args:[c.OAUTH_INFO]}]},{type:void 0,decorators:[{type:t.Inject,args:[c.API]}]}]},e}(),D=function(){function e(e,t,r,n,s,a,i,l){this.router=e,this.route=t,this.toastr=r,this.translate=n,this.enc=s,this.httpBaseService=a,this.oauthResource=i,this.apiPath=l,this.buttonForgotPassword=!1,this.progressBar=25,this.patternPassword=c.Pattern.PASSWORD_MEDIUM,this.form=new o.FormGroup({newPassword:new o.FormControl,confirmPassword:new o.FormControl}),this.destroy$=new d.Subject,null!==this.route.snapshot.params.id&&null!==this.route.snapshot.params.code?(this.verificationId=this.route.snapshot.params.id,this.verificationCode=this.route.snapshot.params.code):this.router.navigate(["/auth/login"])}return e.prototype.ngOnDestroy=function(){this.destroy$.next(!0),this.destroy$.complete(),this.destroy$.unsubscribe()},e.prototype.forgotPassword=function(){var e=this;if(!this.form.invalid){document.querySelectorAll(".pace-done").forEach((function(e){e.className=e.className.replace("pace-done pace-done","pace-running"),e.className=e.className.replace("pace-done","pace-running")})),document.querySelectorAll(".pace-inactive").forEach((function(e){e.className=e.className.replace("pace-inactive pace-inactive","pace-active"),e.className=e.className.replace("pace-inactive","pace-active")}));var t=document.getElementsByClassName("pace-progress").item(0);this.progressBar<35&&(this.progressBar=35,t.style.transform="translate3d("+this.progressBar+"%, 0px, 0px)",t.getAttributeNode("data-progress-text").value=this.progressBar+"%",t.getAttributeNode("data-progress").value=this.progressBar.toString()),this.responseError=null;var r=this.enc.encryptAES(this.oauthResource.aes_key,this.form.controls.newPassword.value),n=this.enc.encryptAES(this.oauthResource.aes_key,this.form.controls.confirmPassword.value),o={verificationId:this.verificationId,verificationCode:this.verificationCode,newPassword:r,confirmPassword:n},a=new s.HttpHeaders({Authorization:"Basic "+btoa(this.oauthResource.client_id+":"+this.oauthResource.client_secret),"Content-Type":"application/json","Accept-Language":this.translate.currentLang});this.buttonForgotPassword=!0,this.httpBaseService.HTTP_BASE(this.apiPath.auth["forgot-password"],o,a).pipe(h.takeUntil(this.destroy$)).subscribe((function(r){r?(e.toastr.showI18n(r.respStatusMessage[r.respStatusCode]),e.progressBar=90,t.style.transform="translate3d("+e.progressBar+"%, 0px, 0px)",t.getAttributeNode("data-progress-text").value=e.progressBar+"%",t.getAttributeNode("data-progress").value=e.progressBar.toString(),e.progressBar=0,r.respStatusCode===c.ResponseCode.OK_FORGOT_PASSWORD?e.router.navigate(["/auth/login"]):(e.form.reset(),e.buttonForgotPassword=!1)):(e.form.reset(),e.buttonForgotPassword=!1)}),(function(r){e.buttonForgotPassword=!1,e.progressBar=85,t.style.transform="translate3d("+e.progressBar+"%, 0px, 0px)",t.getAttributeNode("data-progress-text").value=e.progressBar+"%",t.getAttributeNode("data-progress").value=e.progressBar.toString(),document.querySelectorAll(".pace-running").forEach((function(e){e.className=e.className.replace("pace-running","pace-done")})),document.querySelectorAll(".pace-active").forEach((function(e){e.className=e.className.replace("pace-active","pace-inactive")})),e.progressBar=0,r instanceof s.HttpErrorResponse||r.respStatusCode&&(e.responseError=r.respStatusMessage[r.respStatusCode])}))}},Object.defineProperty(e.prototype,"hasErrorNewPassword",{get:function(){return this.form.controls.newPassword.errors&&this.form.controls.newPassword.invalid&&this.form.controls.newPassword.touched?this.errorMsgNewPassword="error.pattern.Password":this.errorMsgNewPassword=null,this.form.controls.newPassword&&this.form.controls.newPassword.invalid&&this.form.controls.newPassword.touched},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasSuccessNewPassword",{get:function(){return this.form.controls.newPassword&&this.form.controls.newPassword.valid&&this.form.controls.newPassword.touched},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasErrorConfirmPassword",{get:function(){var e;return this.form.controls.confirmPassword.errors&&this.form.controls.confirmPassword.invalid&&this.form.controls.confirmPassword.touched?this.errorMsgConfirmPassword="error.equal.confirmPassword":this.form.controls.newPassword.value!==this.form.controls.confirmPassword.value?(this.errorMsgConfirmPassword="error.equal.confirmPassword",this.form.controls.confirmPassword.setValidators([(e=this.form,function(t){return e.controls&&e.controls.newPassword.value!==e.controls.confirmPassword.value?{equal:!0}:null})]),this.form.controls.confirmPassword.updateValueAndValidity()):this.errorMsgConfirmPassword=null,this.form.controls.confirmPassword&&this.form.controls.confirmPassword.invalid&&this.form.controls.confirmPassword.touched},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasSuccessConfirmPassword",{get:function(){return this.form.controls.confirmPassword&&this.form.controls.confirmPassword.valid&&this.form.controls.confirmPassword.touched},enumerable:!1,configurable:!0}),e.ctorParameters=function(){return[{type:p.Router},{type:p.ActivatedRoute},{type:u.DoToastrService},{type:a.TranslateService},{type:c.EncryptionService},{type:void 0,decorators:[{type:t.Inject,args:[c.HTTP_SERVICE]}]},{type:void 0,decorators:[{type:t.Inject,args:[c.OAUTH_INFO]}]},{type:void 0,decorators:[{type:t.Inject,args:[c.API]}]}]},e.decorators=[{type:t.Component,args:[{selector:"do-forgot-page",template:'<h1 id="title" class="title">{{ \'Reset Password\' | translate }}</h1>\n<p class="sub-title">{{ \'subtitle.reset-password\' | translate }}</p>\n\n<nb-alert *ngIf="responseError" outline="danger" role="alert">\n  <p class="alert-title"><b>{{ \'alert.title.reset-password\' | translate }}</b></p>\n  <ul class="alert-message-list">\n    <li class="alert-message">{{ responseError }}</li>\n  </ul>\n</nb-alert>\n\n<form [formGroup]="form" (ngSubmit)="forgotPassword()" aria-labelledby="title">\n  <div class="form-control-group">\n    <label class="label" for="input-newpassword">{{ \'New Password\' | translate }}* :</label>\n    <input [formControlName]="\'newPassword\'"\n          [required]="true"\n          minlength="8"\n          maxlength="50"\n          [pattern]="patternPassword"\n          [ngClass]="{\n            \'status-danger\': hasErrorNewPassword,\n            \'status-success\': hasSuccessNewPassword\n          }"\n          name="newPassword"\n          type="password"\n          id="inputNewPassword"\n          placeholder="{{ \'New Password\' | translate }}"\n          fieldSize="large"\n          tabindex="4"\n          nbInput\n          fullWidth>\n    <ng-container *ngIf="hasErrorNewPassword">\n      <span class="caption status-danger">{{ errorMsgNewPassword | translate}}</span>\n    </ng-container>\n  </div>\n\n  <div class="form-control-group">\n    <label class="label" for="input-confirmpassword">{{ \'Confirm Password\' | translate }}* :</label>\n    <input [formControlName]="\'confirmPassword\'"\n          [required]="true"\n          minlength="8"\n          maxlength="50"\n          [ngClass]="{\n            \'status-danger\': hasErrorConfirmPassword,\n            \'status-success\': hasSuccessConfirmPassword\n          }"\n          name="confirmPassword"\n          type="password"\n          id="inputConfirmPassword"\n          placeholder="{{ \'Confirm Password\' | translate }}"\n          fieldSize="large"\n          tabindex="5"\n          nbInput\n          fullWidth>\n    <ng-container *ngIf="hasErrorConfirmPassword">\n      <span class="caption status-danger">{{ errorMsgConfirmPassword | translate}}</span>\n    </ng-container>\n  </div>\n\n  <button [disabled]="form.invalid || buttonForgotPassword"\n          fullWidth\n          nbButton\n          status="primary"\n          size="large"\n          [class.btn-pulse]="form.invalid || buttonForgotPassword">\n    {{ \'Reset Password\' | translate }}\n  </button>\n</form>\n\n<section class="another-action" aria-label="Sign in">\n  {{ \'message.reset-password-footer\' | translate}} <a class="text-link" routerLink="/auth/login" tabindex="-1">{{ \'Login\' | translate}}</a>\n</section>\n',styles:[""]}]}],e.ctorParameters=function(){return[{type:p.Router},{type:p.ActivatedRoute},{type:u.DoToastrService},{type:a.TranslateService},{type:c.EncryptionService},{type:void 0,decorators:[{type:t.Inject,args:[c.HTTP_SERVICE]}]},{type:void 0,decorators:[{type:t.Inject,args:[c.OAUTH_INFO]}]},{type:void 0,decorators:[{type:t.Inject,args:[c.API]}]}]},e}();var M=function(){function e(e,t,r,n,o,s,a,i,c){this.router=e,this.httpBaseService=r,this.oauthResource=n,this.apiPath=o,this.authIndexedDB=s,this.profileIndexedDB=a,this.settingsIndexedDB=i,this.idle=c,this.destroy$=new d.Subject,t.snapshot.queryParams.access_token?this.extractToken(t.snapshot.queryParams.access_token):t.snapshot.queryParams.error&&this.router.navigate(["/auth"],{queryParams:{error:t.snapshot.queryParams.error}})}return e.prototype.ngOnDestroy=function(){this.destroy$.next(!0),this.destroy$.next(),this.destroy$.complete()},e.prototype.extractToken=function(e){var t=this;return this.httpBaseService.HTTP_BASE(this.apiPath.auth["extract-token"],this.getAuthBody(e).toString(),this.getAuthHeader()).pipe(h.takeUntil(this.destroy$)).toPromise().then((function(e){t.idle.setIdle(+e.expires_in),t.idle.watch(),t.authIndexedDB.loginStorage(e),t.profileIndexedDB.loginStorage(e),t.settingsIndexedDB.loginStorage(e),t.router.navigate(["/app/home"])})).catch((function(e){t.router.navigate(["/auth"])}))},e.prototype.getAuthBody=function(e){var t=new URLSearchParams;return t.append("access_token",e),t},e.prototype.getAuthHeader=function(){return new s.HttpHeaders({"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic "+btoa(this.oauthResource.client_id+":"+this.oauthResource.client_secret),Accept:"application/json"})},e.ctorParameters=function(){return[{type:p.Router},{type:p.ActivatedRoute},{type:void 0,decorators:[{type:t.Inject,args:[c.HTTP_SERVICE]}]},{type:void 0,decorators:[{type:t.Inject,args:[c.OAUTH_INFO]}]},{type:void 0,decorators:[{type:t.Inject,args:[c.API]}]},{type:P},{type:I},{type:E},{type:m.Idle}]},e.decorators=[{type:t.Component,args:[{selector:"do-oauth2-callback",template:'<p class="sub-title">{{ \'message.callback\' | translate }}</p>\n<div class="spinner-area" [nbSpinner]="true" nbSpinnerSize="small" nbSpinnerStatus="info">',styles:[".nb-theme-default :host .sub-title{margin:1rem}.nb-theme-default :host .spinner-area{height:22px}.nb-theme-default :host ::ng-deep nb-spinner{background:0 0!important}.nb-theme-dark :host .sub-title{margin:1rem}.nb-theme-dark :host .spinner-area{height:22px}.nb-theme-dark :host ::ng-deep nb-spinner{background:0 0!important}.nb-theme-cosmic :host .sub-title{margin:1rem}.nb-theme-cosmic :host .spinner-area{height:22px}.nb-theme-cosmic :host ::ng-deep nb-spinner{background:0 0!important}.nb-theme-corporate :host .sub-title{margin:1rem}.nb-theme-corporate :host .spinner-area{height:22px}.nb-theme-corporate :host ::ng-deep nb-spinner{background:0 0!important}"]}]}],e.ctorParameters=function(){return[{type:p.Router},{type:p.ActivatedRoute},{type:void 0,decorators:[{type:t.Inject,args:[c.HTTP_SERVICE]}]},{type:void 0,decorators:[{type:t.Inject,args:[c.OAUTH_INFO]}]},{type:void 0,decorators:[{type:t.Inject,args:[c.API]}]},{type:P},{type:I},{type:E},{type:m.Idle}]},e}(),H=[{path:"",component:N,children:[{path:"",component:A,canActivate:[T]},{path:"login",component:A,canActivate:[T]},{path:"register",component:j,canActivate:[T]},{path:"forgot-password",component:_,canActivate:[T]},{path:"forgot-password/:id/:code",component:D,canActivate:[T]},{path:"callback",component:M,canActivate:[T]},{path:"logout",component:B,canActivate:[x]}]}],U=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[p.RouterModule.forChild(H)],exports:[p.RouterModule]}]}],e}(),L=function(){function e(){}return e.decorators=[{type:t.Component,args:[{selector:"do-auth-block",template:"\n    <ng-content></ng-content>\n  ",styles:[":host{display:block;width:100%;max-width:35rem}:host ::ng-deep form{width:100%}:host ::ng-deep .label{display:block;margin-bottom:.5rem}:host ::ng-deep .forgot-password{text-decoration:none;margin-bottom:.5rem}:host ::ng-deep .caption{margin-top:.5rem}:host ::ng-deep .alert{text-align:center}:host ::ng-deep .title{margin-top:0;margin-bottom:.75rem;text-align:center}:host ::ng-deep .sub-title{margin-bottom:2rem;text-align:center}:host ::ng-deep .form-control-group{margin-bottom:2rem}:host ::ng-deep .form-control-group.accept-group{display:flex;justify-content:space-between;margin:2rem 0}:host ::ng-deep .label-with-link{display:flex;justify-content:space-between}:host ::ng-deep .links{text-align:center;margin-top:1.75rem}:host ::ng-deep .links .socials{margin-top:1.5rem}:host ::ng-deep .links .socials a{margin:0 1rem;text-decoration:none;vertical-align:middle}:host ::ng-deep .links .socials a.with-icon{font-size:2rem}:host ::ng-deep .another-action{margin-top:2rem;text-align:center}:host ::ng-deep .sign-in-or-up{margin-top:2rem;display:flex;justify-content:space-between}:host ::ng-deep nb-alert .alert-message,:host ::ng-deep nb-alert .alert-title{margin:0 0 .5rem}:host ::ng-deep nb-alert .alert-message-list{list-style-type:none;padding:0;margin:0}"]}]}],e}(),F=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{declarations:[N,L],imports:[r.NbLayoutModule,r.NbCardModule,r.NbIconModule,n.CommonModule,s.HttpClientModule,p.RouterModule,l.DoThemeModule],exports:[N,L]}]}],e}(),$=function(){function e(e,t,r,n){this.translate=e,this.enc=t,this.oauthResource=r,this.authStorage=n}return e.prototype.signHeaders=function(e){var t=this;return d.combineLatest([this.key(),this.signature(this.getPath(e.url))]).pipe(h.take(1),h.switchMap((function(r){if(c.signatureHeader.signature){var n=e.headers?e.headers:new s.HttpHeaders;return n.keys().forEach((function(e){e===c.signatureHeader.key&&(n=n.delete(c.signatureHeader.key)),e===c.signatureHeader.timestamp&&(n=n.delete(c.signatureHeader.timestamp)),e===c.signatureHeader.signature&&(n=n.delete(c.signatureHeader.signature))})),n=(n=(n=n.set(c.signatureHeader.key,r[0])).set(c.signatureHeader.timestamp,t.timestamp())).set(c.signatureHeader.signature,r[1]),d.of(e.clone({headers:n}))}return d.of(e)})))},e.prototype.key=function(){return this.authStorage.getOfEnc(c.oauthInfo.public_key)},e.prototype.timestamp=function(){return Math.floor((new Date).getTime()/1e3).toString()},e.prototype.date=function(){return new n.DatePipe(this.translate.currentLang).transform(new Date,c.DateFormat.DATE)},e.prototype.signature=function(e){var t=this;return d.combineLatest([this.key(),this.authStorage.getOfEnc(c.oauthInfo.access_token)]).pipe(h.take(1),h.switchMap((function(r){var n=r[0]+":"+t.timestamp()+":"+e+":"+r[1];return d.of(t.enc.getHmacSha256(t.oauthResource.private_key,n))})))},e.prototype.getPath=function(e){return"/"+e.replace(/^(http:\/\/www\.|https:\/\/www\.|http:\/\/|https:\/\/)?[a-z0-9]+([\-\.]{1}[a-z0-9]+)*(:[0-9]{1,5})?(\/).*?/g,"")},e.ctorParameters=function(){return[{type:a.TranslateService},{type:c.EncryptionService},{type:void 0,decorators:[{type:t.Inject,args:[c.OAUTH_INFO]}]},{type:P}]},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:a.TranslateService},{type:c.EncryptionService},{type:void 0,decorators:[{type:t.Inject,args:[c.OAUTH_INFO]}]},{type:P}]},e}(),q=function(){function e(e){this.authToken=e,this.destroy$=new d.Subject}return e.prototype.ngOnDestroy=function(){this.destroy$.next(!0),this.destroy$.complete(),this.destroy$.unsubscribe()},e.prototype.intercept=function(e,t){return e.headers&&e.headers.has(c.signatureHeader.mark)?this.authToken.oauthHeaders(e).pipe(h.switchMap((function(e){return t.handle(e)}))):t.handle(e).pipe(h.takeUntil(this.destroy$))},e.ctorParameters=function(){return[{type:k}]},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:k}]},e}(),z=function(){function e(e,t){this.authSignature=e,this.oauthResource=t,this.destroy$=new d.Subject}return e.prototype.ngOnDestroy=function(){this.destroy$.next(!0),this.destroy$.complete(),this.destroy$.unsubscribe()},e.prototype.intercept=function(e,t){return e.headers&&e.headers.has(c.signatureHeader.mark)&&this.oauthResource.signature?this.authSignature.signHeaders(e).pipe(h.switchMap((function(e){return t.handle(e)}))):t.handle(e).pipe(h.takeUntil(this.destroy$))},e.ctorParameters=function(){return[{type:$},{type:void 0,decorators:[{type:t.Inject,args:[c.OAUTH_INFO]}]}]},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:$},{type:void 0,decorators:[{type:t.Inject,args:[c.OAUTH_INFO]}]}]},e}(),W=function(){function e(e,t){this.locale=e,this.settingsIndexedDB=t}return e.prototype.getLocale=function(e){var t=this;return d.from(this.settingsIndexedDB.get("locale")).pipe(h.take(1),h.switchMap((function(r){var n=e.headers?e.headers:new s.HttpHeaders,o=r&&r.match(new RegExp(c.Pattern.LOCALE,"g"))?r:t.locale;return n=n.append("Accept-Language",o),d.of(e.clone({headers:n}))})))},e.ctorParameters=function(){return[{type:String,decorators:[{type:t.Inject,args:[t.LOCALE_ID]}]},{type:E}]},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:String,decorators:[{type:t.Inject,args:[t.LOCALE_ID]}]},{type:E}]},e}(),V=function(){function e(e){this.authLanguage=e,this.destroy$=new d.Subject}return e.prototype.ngOnDestroy=function(){this.destroy$.next(!0),this.destroy$.complete(),this.destroy$.unsubscribe()},e.prototype.intercept=function(e,t){return e.headers&&e.headers.has(c.signatureHeader.mark)?this.authLanguage.getLocale(e).pipe(h.switchMap((function(e){return t.handle(e)}))):t.handle(e).pipe(h.takeUntil(this.destroy$))},e.ctorParameters=function(){return[{type:W}]},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:W}]},e}(),G=function(){function e(e,t,r,n){this.translate=e,this.authToken=t,this.authStorage=r,this.authSignature=n,this.isRefreshingToken=!1,this.refreshTokenSubject=new d.BehaviorSubject(null)}return e.prototype.errorHandler=function(e,t,r){var n=new s.HttpErrorResponse({error:e.error,headers:e.headers,status:e.status,statusText:e.statusText,url:e.url});if(e.error instanceof ArrayBuffer){var o=String.fromCharCode.apply(null,new Uint8Array(e.error));n=new s.HttpErrorResponse({error:JSON.parse(o),headers:e.headers,status:e.status,statusText:e.statusText,url:e.url})}switch(n.status){case 200:case 201:case 304:return d.EMPTY;case 400:return this.error400(n);case 401:return this.error401(n,t,r);case 404:case 403:case 500:case 504:case 0:return d.throwError(this.errorDefault(n))}return d.throwError(n)},e.prototype.errorDefault=function(e){var t={respStatusCode:e.status,respStatusMessage:{}};t.respStatusMessage[t.respStatusCode]=e.statusText;var r="error."+t.respStatusCode;return e.error&&e.error.respStatusCode&&(r=(t=e.error).respStatusMessage[t.respStatusCode]),this.translate.get(r).subscribe((function(e){t.respStatusMessage[t.respStatusCode]=e})),t},e.prototype.error400=function(e){if(e.error.respStatusCode){if("invalid_grant"!==e.error.respStatusCode)return d.throwError(this.errorDefault(e));switch(e.error.respStatusMessage.invalid_grant){case"Bad credentials":case"User account is locked":case"User is disabled":case"User account has expired":case"User credentials have expired":return d.throwError(this.errorDefault(e));default:return this.authToken.logout(),d.throwError(this.errorDefault(e))}}return d.throwError(e)},e.prototype.error401=function(e,t,r){var n=this;if(e.error&&"invalid_token"===e.error.respStatusCode){if(!this.isRefreshingToken)return this.isRefreshingToken=!0,this.refreshTokenSubject.next(null),this.authToken.refresh().pipe(h.switchMap((function(e){return n.isRefreshingToken=!1,n.refreshTokenSubject.next(e),n.authToken.oauthHeaders(t).pipe(h.switchMap((function(e){return t=e,n.authSignature.signHeaders(t).pipe(h.switchMap((function(e){return r.handle(e)})))})))})),h.catchError((function(e){return n.errorHandler(e,t,r)})));if(!e.error.respStatusMessage.invalid_token.includes("expired"))return this.refreshTokenSubject.pipe(h.filter((function(e){return null!=e})),h.take(1),h.switchMap((function(){return n.authToken.oauthHeaders(t).pipe(h.switchMap((function(e){return t=e,n.authSignature.signHeaders(t).pipe(h.switchMap((function(e){return r.handle(e)})))})))})));this.authToken.logout()}return d.throwError(e)},e}(),K=function(e){function r(t,r,n,o){var s=e.call(this,t,r,n,o)||this;return s.translate=t,s.authToken=r,s.authStorage=n,s.authSignature=o,s.destroy$=new d.Subject,s}return y(r,e),r.prototype.ngOnDestroy=function(){this.destroy$.next(!0),this.destroy$.complete(),this.destroy$.unsubscribe()},r.prototype.intercept=function(e,t){var r=this;return t.handle(e).pipe(h.catchError((function(n){return n instanceof s.HttpErrorResponse?r.errorHandler(n,e,t):d.throwError(n)}))).pipe(h.takeUntil(this.destroy$))},r.ctorParameters=function(){return[{type:a.TranslateService},{type:k},{type:P},{type:$}]},r.decorators=[{type:t.Injectable}],r.ctorParameters=function(){return[{type:a.TranslateService},{type:k},{type:P},{type:$}]},r}(G),J=function(e){function r(t,r,n,o){var s=e.call(this)||this;return s.profileIndexedDB=t,s.authIndexedDB=r,s.apiPath=n,s.httpBaseService=o,s.loaderUserSubject$=new d.Subject,s}return y(r,e),r.prototype.loadPhotoUser=function(){var e=this;Promise.all([this.profileIndexedDB.get("image-b64"),this.profileIndexedDB.get("image"),this.profileIndexedDB.get("name"),this.authIndexedDB.getEnc("provider")]).then((function(t){if(t[0])Promise.all([e.profileIndexedDB.get("name"),e.profileIndexedDB.get("image-b64")]).then((function(t){var r={name:t[0],picture:t[1]};e.loaderUserSubject$.next(r)}));else if("local"===t[3])t[1]&&t[2]?e.getImage(t[1],t[2]):e.httpBaseService.HTTP_AUTH(e.apiPath.profile["get-profile"]).subscribe((function(t){Promise.all([e.profileIndexedDB.put("name",t.name),e.profileIndexedDB.put("email",t.email),e.profileIndexedDB.put("image",t.image)]).then((function(){e.getImage(t.image,t.name)}))}));else{var r={name:t[2],picture:t[1]};e.loaderUserSubject$.next(r)}}))},r.prototype.updatePhotoUser=function(e,t){var r=this;if(e&&t){var n,o=new Blob([e],{type:"image/png"});this.profileIndexedDB.put(c.oauthInfo.image,t).then(),this.profileIndexedDB.put("image-blob",o).then(),this.profileIndexedDB.get("name").then((function(e){var t=new FileReader;t.readAsDataURL(o),t.onloadend=function(){n=t.result.toString();var o={name:e,picture:n};r.profileIndexedDB.put("image-b64",n).then(),r.loaderUserSubject$.next(o)}}))}else this.loaderUserSubject$.next(null);return this.loaderUserSubject$.asObservable()},r.prototype.updateNameUser=function(e){var t=this;return this.profileIndexedDB.put("name",e).then(),Promise.all([this.profileIndexedDB.get("image-b64"),this.profileIndexedDB.get("image")]).then((function(r){var n;n=r[0]?r[0]:r[1];var o={name:e,picture:n};t.loaderUserSubject$.next(o)})),this.loaderUserSubject$.asObservable()},r.prototype.getUser=function(){return this.loaderUserSubject$.asObservable()},r.prototype.getImage=function(e,t){var r=this;null!=e&&this.httpBaseService.HTTP_AUTH(this.apiPath.file["vw-photo-profile"],null,null,null,[e],"arraybuffer").pipe(h.map((function(e){var n,o=new Blob([e],{type:"image/png"});r.profileIndexedDB.put("image-blob",o).then();var s=new FileReader;s.readAsDataURL(o),s.onloadend=function(){n=s.result.toString();var e={name:t,picture:n};r.profileIndexedDB.put("image-b64",n).then(),r.loaderUserSubject$.next(e)}}))).subscribe()},r.ctorParameters=function(){return[{type:I},{type:P},{type:void 0,decorators:[{type:t.Inject,args:[c.API]}]},{type:void 0,decorators:[{type:t.Inject,args:[c.HTTP_SERVICE]}]}]},r.decorators=[{type:t.Injectable}],r.ctorParameters=function(){return[{type:I},{type:P},{type:void 0,decorators:[{type:t.Inject,args:[c.API]}]},{type:void 0,decorators:[{type:t.Inject,args:[c.HTTP_SERVICE]}]}]},r}(c.UserInfo),X=[{provide:s.HTTP_INTERCEPTORS,useClass:q,multi:!0},{provide:s.HTTP_INTERCEPTORS,useClass:z,multi:!0},{provide:s.HTTP_INTERCEPTORS,useClass:V,multi:!0},{provide:s.HTTP_INTERCEPTORS,useClass:K,multi:!0},{provide:c.USER_INFO,useClass:J},{provide:c.AUTH_INDEXED_DB,useClass:P},{provide:c.PROFILE_INDEXED_DB,useClass:I},{provide:c.SETTINGS_INDEXED_DB,useClass:E},x,T,k,C,$,W],Q=[A,B,j,_,D,R,M],Y=[R],Z=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:S(X)}},e.decorators=[{type:t.NgModule,args:[{declarations:S(Q),imports:[n.CommonModule,o.FormsModule,a.TranslateModule,o.ReactiveFormsModule,s.HttpClientModule,i.RecaptchaModule,i.RecaptchaFormsModule,r.NbCheckboxModule,r.NbAlertModule,r.NbInputModule,r.NbButtonModule,r.NbIconModule,r.NbCardModule,r.NbSpinnerModule,r.NbDialogModule.forChild(),l.DoThemeModule,u.DoToastrModule.forRoot(),F,U],exports:S(Q),entryComponents:S(Y)}]}],e}(),ee=function(){function e(e){this.location=e}return e.prototype.goToHome=function(){this.location.back()},e.ctorParameters=function(){return[{type:n.Location}]},e.decorators=[{type:t.Component,args:[{selector:"do-404",template:'<div class="flex-centered">\n  <h2 class="title">404</h2>\n  <h2 class="title">Page Not Found</h2>\n  <small class="sub-title">The page you were looking for doesn\'t exist</small>\n  <button nbButton fullWidth (click)="goToHome()" type="button" class="home-button">\n    Take me home\n  </button>\n</div>\n',styles:[".flex-centered{margin:auto}nb-card-body{display:flex}.title{text-align:center}.sub-title{text-align:center;display:block;margin-bottom:3rem}.home-button{margin-bottom:2rem}"]}]}],e.ctorParameters=function(){return[{type:n.Location}]},e}(),te=[{path:"",component:N,children:[{path:"404",component:ee}]}],re=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[p.RouterModule.forChild(te)],exports:[p.RouterModule]}]}],e}(),ne=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[r.NbButtonModule,r.NbIconModule,n.CommonModule,l.DoThemeModule,F,re],declarations:[ee]}]}],e}();e.AuthGuardChildService=C,e.AuthGuardService=x,e.AuthIndexedDBService=P,e.AuthSignatureService=$,e.AuthTokenService=k,e.AuthUserService=J,e.DoAuthModule=Z,e.MiscellaneousModule=ne,e.PageNotFoundComponent=ee,e.ProfileIndexedDBService=I,e.SettingsIndexedDBService=E,e.UnauthorizeGuardService=T,e.ɵa=A,e.ɵb=B,e.ɵc=j,e.ɵd=_,e.ɵe=D,e.ɵf=R,e.ɵg=M,e.ɵh=F,e.ɵi=N,e.ɵj=L,e.ɵk=U,e.ɵl=q,e.ɵm=z,e.ɵn=V,e.ɵo=W,e.ɵp=K,e.ɵq=G,e.ɵr=re,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=dongkap-do-auth.umd.min.js.map