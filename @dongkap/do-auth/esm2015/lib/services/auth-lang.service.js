import { Injectable, Inject, LOCALE_ID } from '@angular/core';
import { HttpHeaders } from '@angular/common/http';
import { of, from } from 'rxjs';
import { take, switchMap } from 'rxjs/operators';
import { Pattern } from '@dongkap/do-core';
import { SettingsIndexedDBService } from '../storage/settings-indexeddb.service';
export class AuthLanguageService {
    constructor(locale, settingsIndexedDB) {
        this.locale = locale;
        this.settingsIndexedDB = settingsIndexedDB;
    }
    getLocale(req) {
        return from(this.settingsIndexedDB.get('locale')).pipe(take(1), switchMap((value) => {
            let httpHeaders = req.headers ? req.headers : new HttpHeaders();
            const localeCode = value ?
                (value.match(new RegExp(Pattern.LOCALE, 'g')) ?
                    value :
                    this.locale) : this.locale;
            httpHeaders = httpHeaders.append('Accept-Language', localeCode);
            return of(req.clone({ headers: httpHeaders }));
        }));
    }
}
AuthLanguageService.ctorParameters = () => [
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: SettingsIndexedDBService }
];
AuthLanguageService.decorators = [
    { type: Injectable }
];
AuthLanguageService.ctorParameters = () => [
    { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
    { type: SettingsIndexedDBService }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aC1sYW5nLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZG9uZ2thcC9kby1hdXRoLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL2F1dGgtbGFuZy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM5RCxPQUFPLEVBQUUsV0FBVyxFQUFlLE1BQU0sc0JBQXNCLENBQUM7QUFDaEUsT0FBTyxFQUFjLEVBQUUsRUFBRSxJQUFJLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDNUMsT0FBTyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNqRCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDM0MsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sdUNBQXVDLENBQUM7QUFHakYsTUFBTSxPQUFPLG1CQUFtQjtJQUU1QixZQUF1QyxNQUFjLEVBQ3pDLGlCQUEyQztRQURoQixXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQ3pDLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBMEI7SUFBRyxDQUFDO0lBRTNELFNBQVMsQ0FBQyxHQUFxQjtRQUMzQixPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUNsRCxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQ1AsU0FBUyxDQUFDLENBQUMsS0FBVSxFQUFFLEVBQUU7WUFDekIsSUFBSSxXQUFXLEdBQWdCLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUksV0FBVyxFQUFFLENBQUM7WUFDN0UsTUFBTSxVQUFVLEdBQVcsS0FBSyxDQUFDLENBQUM7Z0JBQ2xDLENBQ0ksS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDOUMsS0FBSyxDQUFDLENBQUM7b0JBQ1AsSUFBSSxDQUFDLE1BQU0sQ0FDZCxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDO1lBQ2hCLFdBQVcsR0FBRyxXQUFXLENBQUMsTUFBTSxDQUFDLGlCQUFpQixFQUFFLFVBQVUsQ0FBQyxDQUFDO1lBQ2hFLE9BQU8sRUFBRSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ25ELENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDUixDQUFDOzs7eUNBakJZLE1BQU0sU0FBQyxTQUFTO1lBQ0Usd0JBQXdCOzs7WUFKMUQsVUFBVTs7O3lDQUdNLE1BQU0sU0FBQyxTQUFTO1lBTHhCLHdCQUF3QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIEluamVjdCwgTE9DQUxFX0lEIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBIdHRwSGVhZGVycywgSHR0cFJlcXVlc3QgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBvZiwgZnJvbSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgdGFrZSwgc3dpdGNoTWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgUGF0dGVybiB9IGZyb20gJ0Bkb25na2FwL2RvLWNvcmUnO1xuaW1wb3J0IHsgU2V0dGluZ3NJbmRleGVkREJTZXJ2aWNlIH0gZnJvbSAnLi4vc3RvcmFnZS9zZXR0aW5ncy1pbmRleGVkZGIuc2VydmljZSc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBBdXRoTGFuZ3VhZ2VTZXJ2aWNlIHtcblxuICAgIGNvbnN0cnVjdG9yKEBJbmplY3QoTE9DQUxFX0lEKSBwcml2YXRlIGxvY2FsZTogc3RyaW5nLFxuICAgICAgICBwcml2YXRlIHNldHRpbmdzSW5kZXhlZERCOiBTZXR0aW5nc0luZGV4ZWREQlNlcnZpY2UpIHt9XG5cbiAgICBnZXRMb2NhbGUocmVxOiBIdHRwUmVxdWVzdDxhbnk+KTogT2JzZXJ2YWJsZTxIdHRwUmVxdWVzdDxhbnk+PiB7XG4gICAgICAgIHJldHVybiBmcm9tKHRoaXMuc2V0dGluZ3NJbmRleGVkREIuZ2V0KCdsb2NhbGUnKSkucGlwZShcbiAgICAgICAgICAgIHRha2UoMSksXG4gICAgICAgICAgICBzd2l0Y2hNYXAoKHZhbHVlOiBhbnkpID0+IHtcbiAgICAgICAgICAgIGxldCBodHRwSGVhZGVyczogSHR0cEhlYWRlcnMgPSByZXEuaGVhZGVycyA/IHJlcS5oZWFkZXJzIDogbmV3IEh0dHBIZWFkZXJzKCk7XG4gICAgICAgICAgICBjb25zdCBsb2NhbGVDb2RlOiBzdHJpbmcgPSB2YWx1ZSA/XG4gICAgICAgICAgICAoXG4gICAgICAgICAgICAgICAgdmFsdWUubWF0Y2gobmV3IFJlZ0V4cChQYXR0ZXJuLkxPQ0FMRSwgJ2cnKSkgP1xuICAgICAgICAgICAgICAgIHZhbHVlIDpcbiAgICAgICAgICAgICAgICB0aGlzLmxvY2FsZVxuICAgICAgICAgICAgKSA6IHRoaXMubG9jYWxlO1xuICAgICAgICAgICAgaHR0cEhlYWRlcnMgPSBodHRwSGVhZGVycy5hcHBlbmQoJ0FjY2VwdC1MYW5ndWFnZScsIGxvY2FsZUNvZGUpO1xuICAgICAgICAgICAgcmV0dXJuIG9mKHJlcS5jbG9uZSh7IGhlYWRlcnM6IGh0dHBIZWFkZXJzIH0pKTtcbiAgICAgICAgfSkpO1xuICAgIH1cblxufVxuIl19